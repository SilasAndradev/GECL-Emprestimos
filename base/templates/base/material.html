<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerenciar Materiais - Grêmio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 text-gray-800 relative">

  <!-- Botão mobile -->
  <button id="toggle-sidebar" class="absolute top-4 left-4 md:hidden p-2 bg-black text-white rounded z-40">
    Menu
  </button>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 flex flex-col w-64 bg-black shadow-lg p-4 space-y-6 z-30">
    <h2 class="text-xl font-bold text-white">Painel do Grêmio</h2>
    <nav class="flex flex-col space-y-2">
      <a href="{% url 'indexAdm' %}" class="flex items-center gap-2 text-white">
        <i data-lucide="clipboard-list" class="w-5 h-5"></i> Solicitações
      </a>
      <a href="{% url 'material' %}" class="flex items-center gap-2 font-bold text-white">
        <i data-lucide="archive" class="w-5 h-5"></i> Materiais
      </a>
      <a href="{% url 'lista_usuario' %}" class="flex items-center gap-2 text-white">
        <i data-lucide="users" class="w-5 h-5"></i> Usuários
      </a>
      <a href="{% url 'configuracoes' %}" class="flex items-center gap-2 text-white">
        <i data-lucide="settings" class="w-5 h-5"></i> Configurações
      </a>
    </nav>
  </aside>

  <!-- Conteúdo -->
  <div class="flex min-h-screen md:ml-64">
    <main class="flex-1 p-6 mt-16 md:mt-0 w-full">
      <div class="max-w-4xl mx-auto space-y-6">

        <h1 class="text-2xl font-bold text-center">Materiais Disponíveis</h1>

        {% if user.is_staff %}
        <!-- Formulário para adicionar material -->
        <form method="POST" class="bg-white p-4 rounded-xl shadow space-y-4 flex flex-wrap gap-4 items-end">
          {% csrf_token %}
          <div class="flex-1 min-w-[200px]">
            {{ form.nome }}
          </div>
          <div class="min-w-[150px]">
            {{ form.quantidade_total }}
          </div>
          <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium">
            Adicionar
          </button>
        </form>
        {% endif %}

        <!-- Campo de busca -->
        <div>
          <input
            type="text"
            id="searchInput"
            placeholder="Pesquisar por nome "
            class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400"
            onkeyup="filterMateriais()"
          />
        </div>

        <!-- Lista de materiais -->
        <div class="space-y-4">
          {% if materiais %}
            {% for material in materiais %}
              <div class="material bg-white p-4 rounded-xl shadow flex justify-between items-center" data-nome="{{ material.nome }}" data-tipo="{{ material.tipo }}">
                <div>
                  <h2 class="text-lg font-semibold">{{ material.nome }}</h2>
                  <p class="text-sm text-gray-600">Total: {{ material.quantidade_total }}</p>
                  <p class="text-sm text-gray-600">Disponível: {{ material.quantidade_disponivel }}</p>
                </div>
                {% if user.is_staff %}
                <form method="POST" action="{% url 'remover_material' material.id %}">
                  {% csrf_token %}
                  <button type="submit" class="text-red-500 hover:text-red-700 text-sm">
                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                  </button>
                </form>
                {% endif %}
              </div>
            {% endfor %}
          {% else %}
            <p class="text-center text-gray-500">Nenhum material cadastrado.</p>
          {% endif %}
        </div>

      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script>
    lucide.createIcons();

    const toggleButton = document.getElementById("toggle-sidebar");
    const sidebar = document.getElementById("sidebar");

    toggleButton.addEventListener("click", () => {
      sidebar.classList.toggle("-translate-x-full");
    });

    function filterMateriais() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const materiais = document.querySelectorAll(".material");

      materiais.forEach(material => {
        const nome = material.getAttribute("data-nome").toLowerCase();
        const tipo = material.getAttribute("data-tipo").toLowerCase();
        const match = nome.includes(input) || tipo.includes(input);
        material.style.display = match ? "flex" : "none";
      });
    }
  </script>
</body>
</html>
